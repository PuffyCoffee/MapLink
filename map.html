<!DOCTYPE html>
<html>
	<head>
		<title>Nokia map</title>
		<script type="text/javascript"></script>
	</head>
	<body>
		<div id="map" style="width: 1100px; height: 400px; border: 1px solid blue;"></div>
		<script type="text/javascript" src="http://api.maps.nokia.com/2.2.4/jsl.js?with=all" charset="utf-8"></script>
		<script type="text/javascript">
			
			nokia.Settings.set( "appId", "BHxHStxQrJjIm7RgQu6w"); 
			nokia.Settings.set( "authenticationToken", "mQpGuUCaws9NYdgvv5V3Dw");
			var map = new nokia.maps.map.Display(document.getElementById("map"), {
				center: [33.59, -7.61],
				zoomLevel: 4,
				components: 
				[
					new nokia.maps.map.component.Behavior(),
					new nokia.maps.map.component.TypeSelector(),
					new nokia.maps.map.component.ScaleBar(),
					new nokia.maps.map.component.ZoomBar(),
					new nokia.maps.map.component.Overview()
				]
			});
			var bubble = new nokia.maps.map.component.InfoBubbles();
			map.addComponent(bubble);
			var marker_1 = new nokia.maps.map.StandardMarker([40.73, -10], {
				pen: new nokia.maps.util.Pen({
					strokeColor: "#fff"
				})
			});
			var marker_2 = new nokia.maps.map.StandardMarker([28.28, 5], {
				pen: new nokia.maps.util.Pen({
					strokeColor: "#fff"
				})
			});
			map.objects.add(marker_1);
			map.objects.add(marker_2);
			var link_start_geo = null;
			var shiftKeyClicked = false;
			window.onkeydown = function(event) {
				console.log(event.shiftKey);
				if (event.shiftKey)
					shiftKeyClicked = true;
			};
			window.onkeyup = function(event) {
				shiftKeyClicked = false;
			};
			marker_1.addListener("click", function(event) {
				if (xbox) {
					console.log(shiftKeyClicked);
					if (shiftKeyClicked) {
						link_start_geo = this.coordinate;
					}
				}
			});
			marker_2.addListener("click", function(event) {
				console.log(shiftKeyClicked);
				if (xbox) {
					if (shiftKeyClicked && link_start_geo != null) {
						var line = new nokia.maps.map.Polyline([
							new nokia.maps.geo.Coordinate(link_start_geo.latitude, link_start_geo.longitude),
							new nokia.maps.geo.Coordinate(this.coordinate.latitude, this.coordinate.longitude)
						], {
							pen: new nokia.maps.util.Pen({
								lineWidth: 3,
								strokeColor: "#4185F3"
							})
						});
						line.addListener("click", function(evt) {
							var coord = map.pixelToGeo(evt.displayX, evt.displayY);
							if (bubble) {
								bubble.openBubble("Short trip.", coord);
							}
						})
						map.objects.add(line);
					}
				}
			});
			
		</script>
	</body>
</html>






